{% extends 'main/rally/edit/base.html' %}
{% load widget_tweaks %}

{% block page-title %}Edit rally planning{% endblock %}

{% block page-header %}Edit rally planning{% endblock %}

{% block page-body %}

{% if error %}
<p>
    An error occurred while retrieving the planning of the rally.
</p>
<div>Error details:
    <pre class="error-details">{{ error }}</pre>
</div>
<p>
    Please contact an administrator if you can't solve the problem.
</p>
{% else %}

<form method="POST" action="{% url 'rally-edit-planning' pk=rally.id %}?redirect=rally-edit-planning&redirect_pk={{ rally.id }}">
    {% csrf_token %}
    <input type="hidden" id="StagesCount" name="stages_count" value="{{ stages_count }}">

    <div class="input-group mb-3 shadow">
        <div class="input-group-prepend">
            <span class="input-group-text">Rally name</span>
        </div>
        <input type="text" value="{{ rally.label }}" class="form-control" title="Rally name" readonly="readonly">
    </div>

    <div class="input-group mb-3">
        <div class="input-group-prepend">
            <label class="input-group-text" for="{{ form_planning.opened_at.id_for_label }}">Opens at</label>
        </div>
        {% if planning_is_editable %}
        {% render_field form_planning.opened_at class+='form-control' %}
        {% else %}
        <input type="text" id="{{ form_planning.opened_at.id_for_label }}" value="{{ form_planning.opened_at.value }}" class="form-control" readonly="readonly"/>
        {% endif %}
        <div class="input-group-append">
            {% include 'main/generic/help_button.html' with title='Date format' content='<p>Please respect below date format:<br />YYYY-MM-DD HH:MM:SS</p><p>Examples:<br />2018-12-31 23:59:59<br />2019-01-01 00:00:00</p>' %}
        </div>
    </div>

    <div class="input-group mb-3">
        <div class="input-group-prepend">
            <label class="input-group-text" for="{{ form_planning.started_at.id_for_label }}">Starts at</label>
        </div>
        {% if planning_is_editable %}
        {% render_field form_planning.started_at class+='form-control' %}
        {% else %}
        <input type="text" id="{{ form_planning.started_at.id_for_label }}" value="{{ form_planning.started_at.value }}" class="form-control" readonly="readonly"/>
        {% endif %}
        <div class="input-group-append">
            {% include 'main/generic/help_button.html' with title='Date format' content='<p>Please respect below date format:<br />YYYY-MM-DD HH:MM:SS</p><p>Examples:<br />2018-12-31 23:59:59<br />2019-01-01 00:00:00</p>' %}
        </div>
    </div>

   {% if planning_is_editable %}
    <div class="panel-footer mt-4 mb-3">
        <a href="{% url 'rally-edit-planning' pk=rally.id %}?redirect=rally-edit-planning&redirect_pk={{ rally.id }}" class="btn btn-secondary">Cancel</a>
         <button type="submit" class="btn btn-primary">Save planning</button>
    </div>
   {% endif %}

</form>

{% endif %}

{% endblock %}
